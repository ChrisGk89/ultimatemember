function UM_hide_menus(){menu=jQuery(".um-dropdown"),menu.parents("div").find("a").removeClass("active"),menu.hide()}function um_menu_responsive(){jQuery(".um-dropdown").each(function(){var e=jQuery(this),t=jQuery(this).attr("data-element"),a=jQuery(this).attr("data-position");jQuery(t).addClass("um-trigger-menu-on-"+e.attr("data-trigger")),jQuery(window).width()<=1200&&"div.um-profile-edit"==t&&(a="lc"),"lc"==a&&(200>jQuery(t).find("img").width()?left_p=(jQuery(t).width()-jQuery(t).find("img").width())/2+(jQuery(t).find("img").width()-200)/2:left_p=(jQuery(t).width()-jQuery(t).find("img").width())/2,top_=parseInt(jQuery(t).find("a").css("top")),top_?(top_p=jQuery(t).find("img").height()+4+top_,left_gap=4):(top_p=jQuery(t).find("img").height()+4,left_gap=0),4==top_p&&"div.um-cover"==t?top_p=jQuery(t).height()/2+e.height()/2:4==top_p&&(top_p=jQuery(t).height()+20),gap_right=jQuery(t).width()+17,e.css({top:0,width:200,left:"auto",right:gap_right+"px","text-align":"center"}),e.find(".um-dropdown-arr").find("i").removeClass().addClass("um-icon-arrow-right-b"),e.find(".um-dropdown-arr").css({top:"4px",left:"auto",right:"-17px"})),"bc"==a&&(200>jQuery(t).find("img").width()?left_p=(jQuery(t).width()-jQuery(t).find("img").width())/2+(jQuery(t).find("img").width()-200)/2:left_p=(jQuery(t).width()-jQuery(t).find("img").width())/2,top_=parseInt(jQuery(t).find("a").css("top")),top_?(top_p=jQuery(t).find("img").height()+4+top_,left_gap=4):(top_p=jQuery(t).find("img").height()+4,left_gap=0),4==top_p&&"div.um-cover"==t?top_p=jQuery(t).height()/2+e.height()/2:4==top_p&&(top_p=jQuery(t).height()+20),e.css({top:top_p,width:200,left:left_p+left_gap,right:"auto","text-align":"center"}),e.find(".um-dropdown-arr").find("i").removeClass().addClass("um-icon-arrow-up-b"),e.find(".um-dropdown-arr").css({top:"-17px",left:e.width()/2-12,right:"auto"}))})}function um_init_image_upload(e,t){t=t.find(".um-single-image-upload");var a="";t.data("upload_help_text")&&(a='<span class="help">'+t.data("upload_help_text")+"</span>");var i="";t.data("icon")&&(i='<span class="icon"><i class="'+t.data("icon")+'"></i></span>');var r="";t.data("upload_text")&&(r='<span class="str">'+t.data("upload_text")+"</span>");var o=null;jQuery('input[name="user_id"][type="hidden"]').length>0&&(o=jQuery('input[name="user_id"][type="hidden"]').val()),t.uploadFile({url:wp.ajax.settings.url,method:"POST",multiple:!1,formData:{action:"um_imageupload",key:t.data("key"),set_id:t.data("set_id"),set_mode:t.data("set_mode"),_wpnonce:t.data("nonce"),timestamp:t.data("timestamp"),user_id:o},fileName:t.data("key"),allowedTypes:t.data("allowed_types"),maxFileSize:t.data("max_size"),dragDropStr:i+r+a,sizeErrorStr:t.data("max_size_error"),extErrorStr:t.data("extension_error"),maxFileCountErrorStr:t.data("max_files_error"),maxFileCount:1,showDelete:!1,showAbort:!1,showDone:!1,showFileCounter:!1,showStatusAfterSuccess:!0,onSubmit:function(e){t.parents(".um-modal-body").find(".um-error-block").remove()},onSuccess:function(e,a,i){t.selectedFiles=0;try{a=jQuery.parseJSON(a)}catch(e){return void console.log(e,a)}a.error&&""!=a.error?(t.parents(".um-modal-body").append('<div class="um-error-block">'+a.error+"</div>"),t.parents(".um-modal-body").find(".upload-statusbar").hide(0),um_modal_responsive()):jQuery.each(a,function(e,a){var i=t.parents(".um-modal-body").find(".um-single-image-preview img"),r=t.parents(".um-modal-body").find(".um-single-image-preview"),o=new Date;i.attr("src",a.url+"?"+o.getTime()),i.data("file",a.file),i.load(function(){t.parents(".um-modal-body").find(".um-modal-btn.um-finish-upload.disabled").removeClass("disabled"),t.parents(".um-modal-body").find(".ajax-upload-dragdrop,.upload-statusbar").hide(0),r.show(0),um_modal_responsive()})})}})}function um_init_file_upload(e,t){t=t.find(".um-single-file-upload");var a="";t.data("upload_help_text")&&(a='<span class="help">'+t.data("upload_help_text")+"</span>");var i="";t.data("icon")&&(i='<span class="icon"><i class="'+t.data("icon")+'"></i></span>');var r="";t.data("upload_text")&&(r='<span class="str">'+t.data("upload_text")+"</span>"),t.uploadFile({url:wp.ajax.settings.url,method:"POST",multiple:!1,formData:{action:"um_fileupload",key:t.data("key"),set_id:t.data("set_id"),set_mode:t.data("set_mode"),_wpnonce:t.data("nonce"),timestamp:t.data("timestamp")},fileName:t.data("key"),allowedTypes:t.data("allowed_types"),maxFileSize:t.data("max_size"),dragDropStr:i+r+a,sizeErrorStr:t.data("max_size_error"),extErrorStr:t.data("extension_error"),maxFileCountErrorStr:t.data("max_files_error"),maxFileCount:1,showDelete:!1,showAbort:!1,showDone:!1,showFileCounter:!1,showStatusAfterSuccess:!0,onSubmit:function(e){t.parents(".um-modal-body").find(".um-error-block").remove()},onSuccess:function(e,a,i){t.selectedFiles=0,a=jQuery.parseJSON(a),a.error&&""!=a.error?(t.parents(".um-modal-body").append('<div class="um-error-block">'+a.error+"</div>"),t.parents(".um-modal-body").find(".upload-statusbar").hide(0),setTimeout(function(){um_modal_responsive()},1e3)):(jQuery.each(a,function(e,a){t.parents(".um-modal-body").find(".um-modal-btn.um-finish-upload.disabled").removeClass("disabled"),t.parents(".um-modal-body").find(".ajax-upload-dragdrop,.upload-statusbar").hide(0),t.parents(".um-modal-body").find(".um-single-file-preview").show(0),"icon"==e?t.parents(".um-modal-body").find(".um-single-fileinfo i").removeClass().addClass(a):"icon_bg"==e?t.parents(".um-modal-body").find(".um-single-fileinfo span.icon").css({"background-color":a}):"filename"==e?t.parents(".um-modal-body").find(".um-single-fileinfo a").attr("data-file",a):"original_name"==e?(t.parents(".um-modal-body").find(".um-single-fileinfo a").attr("data-orignal-name",a),t.parents(".um-modal-body").find(".um-single-fileinfo span.filename").html(a)):"url"==e&&t.parents(".um-modal-body").find(".um-single-fileinfo a").attr("href",a)}),setTimeout(function(){um_modal_responsive()},1e3))}})}function um_init_cropper(){var e=jQuery(".um-modal .um-single-image-preview img").first(),t=jQuery(".um-modal .um-single-image-preview"),a=e.parent().attr("data-crop"),i=e.parent().attr("data-min_width"),r=e.parent().attr("data-min_height"),o=e.parent().attr("data-ratio");if(jQuery(".um-modal").find("#um_upload_single").attr("data-ratio"))var o=jQuery(".um-modal").find("#um_upload_single").attr("data-ratio"),n=o.split(":"),o=n[0];if(e.length&&""!=e.attr("src")){var d=jQuery(window).height()-(jQuery(".um-modal-footer a").height()+20)-50-jQuery(".um-modal-header:visible").height();if(e.css({height:"auto"}),t.css({height:"auto"}),jQuery(window).height()<=400?(t.css({height:d+"px","max-height":d+"px"}),e.css({height:"auto"})):(e.css({height:"auto","max-height":d+"px"}),t.css({height:e.height(),"max-height":d+"px"})),"square"==a)var u={minWidth:i,minHeight:r,dragCrop:!1,aspectRatio:1,zoomable:!1,rotatable:!1,dashed:!1,done:function(t){e.parent().attr("data-coord",Math.round(t.x)+","+Math.round(t.y)+","+Math.round(t.width)+","+Math.round(t.height))}};else if("cover"==a){Math.round(i/o)>0&&(r=Math.round(i/o));var u={minWidth:i,minHeight:r,dragCrop:!1,aspectRatio:o,zoomable:!1,rotatable:!1,dashed:!1,done:function(t){e.parent().attr("data-coord",Math.round(t.x)+","+Math.round(t.y)+","+Math.round(t.width)+","+Math.round(t.height))}}}else if("user"==a)var u={minWidth:i,minHeight:r,dragCrop:!0,aspectRatio:"auto",zoomable:!1,rotatable:!1,dashed:!1,done:function(t){e.parent().attr("data-coord",Math.round(t.x)+","+Math.round(t.y)+","+Math.round(t.width)+","+Math.round(t.height))}};0!=a&&(e.cropper(u),jQuery(".um-single-image-preview img.cropper-hidden").cropper("destroy"),jQuery(".um-single-image-preview img.lazyloaded").addClass("cropper-hidden").removeClass("lazyloaded"),jQuery(".um-single-image-preview .cropper-container").append('<div class="um-clear"></div>'))}}jQuery(document).ready(function(){function e(){var e=jQuery('textarea[id="um-meta-bio"]');if("undefined"!=typeof e.val()){var t=e.attr("data-character-limit"),a=t-e.val().length;jQuery("span.um-meta-bio-character span.um-bio-limit").text(a);var i="";a<5&&(i="red"),jQuery("span.um-meta-bio-character").css("color",i)}}function t(e,t,a,r){var o=e.data("um-parent");e.attr("name"),jQuery('select[name="'+o+'"]');e.find('option[value!=""]').remove(),e.hasClass("um-child-option-disabled")||e.removeAttr("disabled");var r=[];jQuery.each(t.items,function(e,t){r.push({id:e,text:t})}),e.select2("destroy"),e.select2({data:r,allowClear:!0,minimumResultsForSearch:10}),"undefined"==typeof t.field.default||e.data("um-original-value")?""!=e.data("um-original-value")&&e.val(e.data("um-original-value")).trigger("change"):e.val(t.field.default).trigger("change"),0==t.field.editable&&(e.addClass("um-child-option-disabled"),e.attr("disabled","disabled")),i[a]=t}jQuery(".um-profile.um-viewing .um-profile-body .um-row").each(function(){var e=jQuery(this);0==e.find(".um-field").length&&(e.prev(".um-row-heading").remove(),e.remove())});var a=jQuery(".um-profile.um-viewing .um-profile-body");a.length&&0==a.find(".um-field").length&&(jQuery(".um-row-heading,.um-row").remove(),jQuery(".um-profile-note").show()),jQuery(document).on("click",".um-profile-save",function(e){return e.preventDefault(),jQuery(this).parents(".um").find("form").submit(),!1}),jQuery(document).on("click",".um-profile-edit-a",function(e){jQuery(this).addClass("active")}),jQuery(document).on("click",".um-cover a.um-cover-add, .um-photo a",function(e){return e.preventDefault(),!1}),jQuery(document).on("click",".um-photo-modal",function(e){e.preventDefault();var t=jQuery(this).attr("data-src");return um_new_modal("um_view_photo","fit",!0,t),!1}),jQuery(document).on("click",".um-reset-profile-photo",function(e){jQuery(".um-profile-photo-img img").attr("src",jQuery(this).attr("data-default_src")),user_id=jQuery(this).attr("data-user_id"),metakey="profile_photo",wp.ajax.send("um_delete_profile_photo",{data:{metakey:metakey,user_id:user_id,nonce:um_scripts.nonce}})}),jQuery(document).on("click",".um-reset-cover-photo",function(e){jQuery(".um-cover-overlay").hide(),jQuery(".um-cover-e").html('<a href="#" class="um-cover-add um-manual-trigger" data-parent=".um-cover" data-child=".um-btn-auto-width"><span class="um-cover-add-i"><i class="um-icon-plus um-tip-n" title="Upload a cover photo"></i></span></a>'),jQuery(".um-dropdown").hide(),um_responsive(),user_id=jQuery(this).attr("data-user_id"),metakey="cover_photo",wp.ajax.send("um_delete_cover_photo",{data:{metakey:metakey,user_id:user_id,nonce:um_scripts.nonce}})}),e(),jQuery('textarea[id="um-meta-bio"]').change(e).keyup(e),jQuery(".um-profile-edit a.um_delete-item").click(function(e){e.preventDefault();var t=confirm("Are you sure that you want to delete this user?");if(!t)return!1}),jQuery(document).on("click",".um-dropdown a",function(e){return!1}),jQuery(document).on("click",".um-dropdown a.real_url",function(e){window.location=jQuery(this).attr("href")}),jQuery(document).on("click",".um-trigger-menu-on-click",function(e){return jQuery(".um-dropdown").hide(),menu=jQuery(this).find(".um-dropdown"),menu.show(),!1}),jQuery(document).on("click",".um-dropdown-hide",function(e){UM_hide_menus()}),jQuery(document).on("click","a.um-manual-trigger",function(){var e=jQuery(this).attr("data-child"),t=jQuery(this).attr("data-parent");jQuery(this).parents(t).find(e).trigger("click")}),jQuery(document).on("click",".um .um-single-image-preview a.cancel",function(e){e.preventDefault();var t=jQuery(this).parents(".um-field"),a=jQuery(this).parents(".um-field").find(".um-single-image-preview img").attr("src");return t.find(".um-single-image-preview img").attr("src",""),t.find(".um-single-image-preview").hide(),t.find(".um-btn-auto-width").html("Upload"),t.find('input[type="hidden"]').val("empty_file"),wp.ajax.send("um_remove_file",{data:{src:a,nonce:um_scripts.nonce}}),!1}),jQuery(document).on("click",".um .um-single-file-preview a.cancel",function(e){e.preventDefault();var t=jQuery(this).parents(".um-field"),a=jQuery(this).parents(".um-field").find(".um-single-fileinfo a").attr("href");return t.find(".um-single-file-preview").hide(),t.find(".um-btn-auto-width").html("Upload"),t.find('input[type="hidden"]').val("empty_file"),wp.ajax.send("um_remove_file",{data:{src:a,nonce:um_scripts.nonce}}),!1});var i={};jQuery("select[data-um-parent]").each(function(){var e=jQuery(this),a=e.data("um-parent"),r=(e.data("um-ajax-url"),e.data("um-ajax-source"));e.val();e.attr("data-um-init-field",!0),jQuery(document).on("change",'select[name="'+a+'"]',function(){var o=jQuery(this),n=o.closest("form").find('input[type="hidden"][name="form_id"]').val(),d=o.val();if(""!=o.val()&&"object"!=typeof i[d]&&wp.ajax.send("um_select_options",{data:{parent_option_name:a,parent_option:o.val(),child_callback:r,child_name:e.attr("name"),form_id:n,nonce:um_scripts.nonce},success:function(a){""!=o.val()&&t(e,a,d),"undefined"!=typeof a.debug&&console.log(a)},error:function(e){console.log(e)}}),""!=o.val()&&"object"==typeof i[d]){var u=i[d];t(e,u,d)}""==o.val()&&(e.find('option[value!=""]').remove(),e.val("").trigger("change"))}),jQuery('select[name="'+a+'"]').trigger("change")}),jQuery(document).on("um_responsive_event",um_menu_responsive),jQuery(document).on("um_before_new_modal_event",UM_hide_menus),jQuery(document).on("um_after_new_modal_nophoto_event",um_init_image_upload),jQuery(document).on("um_after_new_modal_nophoto_event",um_init_file_upload),jQuery(document).on("um_after_modal_responsive_event",um_init_cropper)});